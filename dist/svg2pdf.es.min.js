/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2015-2020 yWorks GmbH
 * Copyright (c) 2013-2015 by Vitaly Puzrin
 *
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

import t from"cssesc";import e from"font-family-papandreou";import{GState as r,ShadingPattern as i,TilingPattern as n,jsPDF as a}from"jspdf";import s from"svgpath";import{compare as o}from"specificity";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function u(t,e){function r(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var h=function(){return(h=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function f(t,e,r,i){return new(r||(r=Promise))((function(n,a){function s(t){try{l(i.next(t))}catch(t){a(t)}}function o(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}l((i=i.apply(t,e||[])).next())}))}function c(t,e){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var p=function(){function t(t){if(this.a=void 0,this.r=0,this.g=0,this.b=0,this.simpleColors={},this.colorDefs=[],this.ok=!1,t){for(var e in"#"==t.charAt(0)&&(t=t.substr(1,6)),t=(t=t.replace(/ /g,"")).toLowerCase(),this.simpleColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgrey:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},this.simpleColors)t==e&&(t=this.simpleColors[e]);this.colorDefs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}];for(var r=0;r<this.colorDefs.length;r++){var i=this.colorDefs[r].re,n=this.colorDefs[r].process,a=i.exec(t);if(a){var s=n(a);this.r=s[0],this.g=s[1],this.b=s[2],this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b}}return t.prototype.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},t.prototype.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+(this.a||"1")+")"},t.prototype.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),r=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==r.length&&(r="0"+r),"#"+t+e+r},t.prototype.getHelpXML=function(){for(var e=[],r=0;r<this.colorDefs.length;r++)for(var i=this.colorDefs[r].example,n=0;n<i.length;n++)e[e.length]=i[n];for(var a in this.simpleColors)e[e.length]=a;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(r=0;r<e.length;r++)try{var o=document.createElement("li"),l=new t(e[r]),u=document.createElement("div");u.style.cssText="margin: 3px; border: 1px solid black; background:"+l.toHex()+"; color:"+l.toHex(),u.appendChild(document.createTextNode("test"));var h=document.createTextNode(" "+e[r]+" -> "+l.toRGB()+" -> "+l.toHex());o.appendChild(u),o.appendChild(h),s.appendChild(o)}catch(t){}return s},t}(),d=function(){function t(t){this.color=t}return t.prototype.getFillData=function(t,e){return f(this,void 0,void 0,(function(){return c(this,(function(t){return[2,void 0]}))}))},t}(),m=function(){function t(){this.xmlSpace="",this.fill=null,this.fillOpacity=1,this.fontFamily="",this.fontSize=16,this.fontStyle="",this.fontWeight="",this.opacity=1,this.stroke=null,this.strokeDasharray=null,this.strokeDashoffset=0,this.strokeLinecap="",this.strokeLinejoin="",this.strokeMiterlimit=4,this.strokeOpacity=1,this.strokeWidth=1,this.alignmentBaseline="",this.textAnchor="",this.visibility="",this.color=null}return t.prototype.clone=function(){var e=new t;return e.xmlSpace=this.xmlSpace,e.fill=this.fill,e.fillOpacity=this.fillOpacity,e.fontFamily=this.fontFamily,e.fontSize=this.fontSize,e.fontStyle=this.fontStyle,e.fontWeight=this.fontWeight,e.opacity=this.opacity,e.stroke=this.stroke,e.strokeDasharray=this.strokeDasharray,e.strokeDashoffset=this.strokeDashoffset,e.strokeLinecap=this.strokeLinecap,e.strokeLinejoin=this.strokeLinejoin,e.strokeMiterlimit=this.strokeMiterlimit,e.strokeOpacity=this.strokeOpacity,e.strokeWidth=this.strokeWidth,e.textAnchor=this.textAnchor,e.alignmentBaseline=this.alignmentBaseline,e.visibility=this.visibility,e.color=this.color,e},t.default=function(){var e=new t;return e.xmlSpace="default",e.fill=new d(new p("rgb(0, 0, 0)")),e.fillOpacity=1,e.fontFamily="times",e.fontSize=16,e.fontStyle="normal",e.fontWeight="normal",e.opacity=1,e.stroke=null,e.strokeDasharray=null,e.strokeDashoffset=0,e.strokeLinecap="butt",e.strokeLinejoin="miter",e.strokeMiterlimit=4,e.strokeOpacity=1,e.strokeWidth=1,e.alignmentBaseline="baseline",e.textAnchor="start",e.visibility="visible",e.color=new p("rgb(0, 0, 0)"),e},t}(),g=/url\(["']?#([^"']+)["']?\)/,y={bottom:"bottom","text-bottom":"bottom",top:"top","text-top":"top",hanging:"hanging",middle:"middle",central:"middle",center:"middle",mathematical:"middle",ideographic:"ideographic",alphabetic:"alphabetic",baseline:"alphabetic"},b=function(){function t(){this.measureMethods={}}return t.prototype.getTextOffset=function(t,e){var r=e.textAnchor;if("start"===r)return 0;var i=this.measureTextWidth(t,e),n=0;switch(r){case"end":n=i;break;case"middle":n=i/2}return n},t.prototype.measureTextWidth=function(t,e){if(0===t.length)return 0;var r=e.fontFamily;return this.getMeasureFunction(r).call(this,t,e.fontFamily,e.fontSize+"px",e.fontStyle,e.fontWeight)},t.prototype.getMeasurementTextNode=function(){if(!this.textMeasuringTextElement){this.textMeasuringTextElement=document.createElementNS("http://www.w3.org/2000/svg","text");var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.appendChild(this.textMeasuringTextElement),t.style.setProperty("position","absolute"),t.style.setProperty("visibility","hidden"),document.body.appendChild(t)}return this.textMeasuringTextElement},t.prototype.canvasTextMeasure=function(t,e,r,i,n){var a=document.createElement("canvas").getContext("2d");return null!=a?(a.font=[i,n,r,e].join(" "),a.measureText(t).width):0},t.prototype.svgTextMeasure=function(t,e,r,i,n,a){void 0===a&&(a=this.getMeasurementTextNode());var s=a;return s.setAttribute("font-family",e),s.setAttribute("font-size",r),s.setAttribute("font-style",i),s.setAttribute("font-weight",n),s.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),s.textContent=t,s.getBBox().width},t.prototype.getMeasureFunction=function(e){var r=this.measureMethods[e];if(!r){var i=this.canvasTextMeasure(t.testString,e,"16px","normal","normal"),n=this.svgTextMeasure(t.testString,e,"16px","normal","normal");r=Math.abs(i-n)<t.epsilon?this.canvasTextMeasure:this.svgTextMeasure,this.measureMethods[e]=r}return r},t.prototype.cleanupTextMeasuring=function(){if(this.textMeasuringTextElement){var t=this.textMeasuringTextElement.parentNode;t&&document.body.removeChild(t),this.textMeasuringTextElement=void 0}},t.testString="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789!\"$%&/()=?'\\+*-_.:,;^}][{#~|<>",t.epsilon=.1,t}(),v=function(){function t(t,e){var r,i,n,a,s,o;this.pdf=t,this.svg2pdfParameters=e.svg2pdfParameters,this.attributeState=e.attributeState?e.attributeState.clone():m.default(),this.viewport=e.viewport,this.refsHandler=null!==(r=e.refsHandler)&&void 0!==r?r:null,this.styleSheets=null!==(i=e.styleSheets)&&void 0!==i?i:null,this.textMeasure=null!==(n=e.textMeasure)&&void 0!==n?n:new b,this.transform=null!==(a=e.transform)&&void 0!==a?a:this.pdf.unitMatrix,this.withinClipPath=null!==(s=e.withinClipPath)&&void 0!==s&&s,this.withinUse=null!==(o=e.withinUse)&&void 0!==o&&o}return t.prototype.clone=function(e){var r,i,n,a,s,o,l,u;return void 0===e&&(e={}),new t(this.pdf,{svg2pdfParameters:null!==(r=e.svg2pdfParameters)&&void 0!==r?r:this.svg2pdfParameters,attributeState:e.attributeState?e.attributeState.clone():this.attributeState.clone(),viewport:null!==(i=e.viewport)&&void 0!==i?i:this.viewport,refsHandler:null!==(n=e.refsHandler)&&void 0!==n?n:this.refsHandler,styleSheets:null!==(a=e.styleSheets)&&void 0!==a?a:this.styleSheets,textMeasure:null!==(s=e.textMeasure)&&void 0!==s?s:this.textMeasure,transform:null!==(o=e.transform)&&void 0!==o?o:this.transform,withinClipPath:null!==(l=e.withinClipPath)&&void 0!==l?l:this.withinClipPath,withinUse:null!==(u=e.withinUse)&&void 0!==u?u:this.withinUse})},t}(),x=function(){function e(t){this.renderedElements={},this.idMap=t}return e.prototype.getRendered=function(t,r,i){return f(this,void 0,void 0,(function(){var n,a;return c(this,(function(s){switch(s.label){case 0:return n=e.generateKey(t,r),this.renderedElements.hasOwnProperty(n)?[2,this.renderedElements[t]]:(a=this.get(t),this.renderedElements[n]=a,[4,i(a)]);case 1:return s.sent(),[2,a]}}))}))},e.prototype.get=function(e){return this.idMap[t(e,{isIdentifier:!0})]},e.generateKey=function(t,e){return t+"|"+(e||new p("rgb(0,0,0)")).toRGBA()},e}();function S(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function w(t,e){return[2/3*(e[0]-t[0])+t[0],2/3*(e[1]-t[1])+t[1]]}function k(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]}function M(t,e){return k([e[0]-t[0],e[1]-t[1]])}function T(t,e){return[t[0]+e[0],t[1]+e[1]]}function C(t,e){var r=t[0],i=t[1];return[e.a*r+e.c*i+e.e,e.b*r+e.d*i+e.f]}var F=function(){function t(){this.segments=[]}return t.prototype.moveTo=function(t,e){return this.segments.push(new A(t,e)),this},t.prototype.lineTo=function(t,e){return this.segments.push(new P(t,e)),this},t.prototype.curveTo=function(t,e,r,i,n,a){return this.segments.push(new B(t,e,r,i,n,a)),this},t.prototype.close=function(){return this.segments.push(new N),this},t.prototype.transform=function(t){this.segments.forEach((function(e){if(e instanceof A||e instanceof P||e instanceof B){var r=C([e.x,e.y],t);e.x=r[0],e.y=r[1]}if(e instanceof B){var i=C([e.x1,e.y1],t),n=C([e.x2,e.y2],t);e.x1=i[0],e.y1=i[1],e.x2=n[0],e.y2=n[1]}}))},t.prototype.draw=function(t){var e=t.pdf;this.segments.forEach((function(t){t instanceof A?e.moveTo(t.x,t.y):t instanceof P?e.lineTo(t.x,t.y):t instanceof B?e.curveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y):e.close()}))},t}(),A=function(t,e){this.x=t,this.y=e},P=function(t,e){this.x=t,this.y=e},B=function(t,e,r,i,n,a){this.x1=t,this.y1=e,this.x2=r,this.y2=i,this.x=n,this.y=a},N=function(){};function O(t,e){return e.split(",").indexOf((t.nodeName||t.tagName).toLowerCase())>=0}function E(t,e,r,i){void 0===i&&(i=r);var n=t.style.getPropertyValue(i);if(n)return n;var a=e.getPropertyValue(t,i);return a||(t.hasAttribute(r)&&t.getAttribute(r)||void 0)}function L(t,e,r){if("none"===E(t.element,r.styleSheets,"display"))return!1;var i=e,n=E(t.element,r.styleSheets,"visibility");return n&&(i="hidden"!==n),i}function I(t,e,r){var i=L(t,e,r);return 0!==t.element.childNodes.length&&(t.children.forEach((function(t){t.isVisible(i,r)&&(i=!0)})),i)}var H=function(){function t(){this.markers=[]}return t.prototype.addMarker=function(t){this.markers.push(t)},t.prototype.draw=function(t){return f(this,void 0,void 0,(function(){var e,r,i,n,a,s,o;return c(this,(function(l){switch(l.label){case 0:e=0,l.label=1;case 1:return e<this.markers.length?(r=this.markers[e],i=void 0,n=r.angle,a=r.anchor,s=Math.cos(n),o=Math.sin(n),i=t.pdf.Matrix(s,o,-o,s,a[0],a[1]),i=t.pdf.matrixMult(t.pdf.Matrix(t.attributeState.strokeWidth,0,0,t.attributeState.strokeWidth,0,0),i),i=t.pdf.matrixMult(i,t.transform),t.pdf.saveGraphicsState(),t.pdf.setLineWidth(1),[4,t.refsHandler.getRendered(r.id,null,(function(e){return e.apply(t)}))]):[3,4];case 2:l.sent(),t.pdf.doFormObject(r.id,i),t.pdf.restoreGraphicsState(),l.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},t}(),V=function(t,e,r){this.id=t,this.anchor=e,this.angle=r};function R(t,e){var r;return(r=t&&t.toString().match(/^([\-0-9.]+)em$/))?parseFloat(r[1])*e:(r=t&&t.toString().match(/^([\-0-9.]+)(px|)$/))?parseFloat(r[1]):0}function D(t){return y[t]||"alphabetic"}function W(t){for(var e,r=[],i=/[+-]?(?:(?:\d+\.?\d*)|(?:\d*\.?\d+))(?:[eE][+-]?\d+)?/g;e=i.exec(t);)r.push(parseFloat(e[0]));return r}function G(t,e){if("transparent"===t){var r=new p("rgb(0,0,0)");return r.a=0,r}if("currentcolor"===t.toLowerCase())return e||new p("rgb(0,0,0)");var i=/\s*rgba\(((?:[^,\)]*,){3}[^,\)]*)\)\s*/.exec(t);if(i){var n=W(i[1]),a=new p("rgb("+n.slice(0,3).join(",")+")");return a.a=n[3],a}return new p(t)}var j={"sans-serif":"helvetica",verdana:"helvetica",arial:"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",serif:"times",cursive:"times",fantasy:"times"};function U(t,e){if("none"===E(e.element,t.styleSheets,"display"))return[0,0,0,0];var r=[0,0,0,0];return e.children.forEach((function(e){var i=e.getBoundingBox(t);r=[Math.min(r[0],i[0]),Math.min(r[1],i[1]),Math.max(r[0]+r[2],i[0]+i[2])-Math.min(r[0],i[0]),Math.max(r[1]+r[3],i[1]+i[3])-Math.min(r[1],i[1])]})),r}function z(t,e){var r=parseFloat,i=r(t.getAttribute("x1"))||r(E(t,e.styleSheets,"x"))||r(E(t,e.styleSheets,"cx"))-r(E(t,e.styleSheets,"r"))||0,n=r(t.getAttribute("x2"))||i+r(E(t,e.styleSheets,"width"))||r(E(t,e.styleSheets,"cx"))+r(E(t,e.styleSheets,"r"))||0,a=r(t.getAttribute("y1"))||r(E(t,e.styleSheets,"y"))||r(E(t,e.styleSheets,"cy"))-r(E(t,e.styleSheets,"r"))||0,s=r(t.getAttribute("y2"))||a+r(E(t,e.styleSheets,"height"))||r(E(t,e.styleSheets,"cy"))+r(E(t,e.styleSheets,"r"))||0;return[Math.min(i,n),Math.min(a,s),Math.max(i,n)-Math.min(i,n),Math.max(a,s)-Math.min(a,s)]}function Y(t,e,r,i,n,a,s,o){void 0===o&&(o=!1);var l,u,h=e[0],f=e[1],c=e[2],p=e[3],d=n/c,m=a/p,g=t.getAttribute("preserveAspectRatio");if(g){var y=g.split(" ");"defer"===y[0]&&(y=y.slice(1)),l=y[0],u=y[1]||"meet"}else l="xMidYMid",u="meet";if("none"!==l&&("meet"===u?d=m=Math.min(d,m):"slice"===u&&(d=m=Math.max(d,m))),o)return s.pdf.Matrix(d,0,0,m,0,0);var b=r-h*d,v=i-f*m;l.indexOf("xMid")>=0?b+=(n-c*d)/2:l.indexOf("xMax")>=0&&(b+=n-c*d),l.indexOf("YMid")>=0?v+=(a-p*m)/2:l.indexOf("YMax")>=0&&(v+=a-p*m);var x=s.pdf.Matrix(1,0,0,1,b,v),S=s.pdf.Matrix(d,0,0,m,0,0);return s.pdf.matrixMult(S,x)}function X(t,e){if(!t||"none"===t)return e.pdf.unitMatrix;for(var r,i,n=/^[\s,]*matrix\(([^)]+)\)\s*/,a=/^[\s,]*translate\(([^)]+)\)\s*/,s=/^[\s,]*rotate\(([^)]+)\)\s*/,o=/^[\s,]*scale\(([^)]+)\)\s*/,l=/^[\s,]*skewX\(([^)]+)\)\s*/,u=/^[\s,]*skewY\(([^)]+)\)\s*/,h=e.pdf.unitMatrix;t.length>0&&t.length!==i;){i=t.length;var f=n.exec(t);if(f&&(r=W(f[1]),h=e.pdf.matrixMult(e.pdf.Matrix(r[0],r[1],r[2],r[3],r[4],r[5]),h),t=t.substr(f[0].length)),f=s.exec(t)){r=W(f[1]);var c=Math.PI*r[0]/180;if(h=e.pdf.matrixMult(e.pdf.Matrix(Math.cos(c),Math.sin(c),-Math.sin(c),Math.cos(c),0,0),h),r[1]||r[2]){var p=e.pdf.Matrix(1,0,0,1,r[1],r[2]),d=e.pdf.Matrix(1,0,0,1,-r[1],-r[2]);h=e.pdf.matrixMult(d,e.pdf.matrixMult(h,p))}t=t.substr(f[0].length)}(f=a.exec(t))&&(r=W(f[1]),h=e.pdf.matrixMult(e.pdf.Matrix(1,0,0,1,r[0],r[1]||0),h),t=t.substr(f[0].length)),(f=o.exec(t))&&((r=W(f[1]))[1]||(r[1]=r[0]),h=e.pdf.matrixMult(e.pdf.Matrix(r[0],0,0,r[1],0,0),h),t=t.substr(f[0].length)),(f=l.exec(t))&&(r=parseFloat(f[1]),r*=Math.PI/180,h=e.pdf.matrixMult(e.pdf.Matrix(1,0,Math.tan(r),1,0,0),h),t=t.substr(f[0].length)),(f=u.exec(t))&&(r=parseFloat(f[1]),r*=Math.PI/180,h=e.pdf.matrixMult(e.pdf.Matrix(1,Math.tan(r),0,1,0,0),h),t=t.substr(f[0].length))}return h}var q=function(){function t(t,e){this.element=t,this.children=e,this.parent=null}return t.prototype.setParent=function(t){this.parent=t},t.prototype.getParent=function(){return this.parent},t.prototype.getBoundingBox=function(t){return"none"===E(this.element,t.styleSheets,"display")?[0,0,0,0]:this.getBoundingBoxCore(t)},t.prototype.computeNodeTransform=function(t){var e=this.computeNodeTransformCore(t),r=E(this.element,t.styleSheets,"transform");return r?t.pdf.matrixMult(e,X(r,t)):e},t}(),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.render=function(t){return Promise.resolve()},e.prototype.getBoundingBoxCore=function(t){return[]},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e}(q),$=function(t){function e(e,r,i){var n=t.call(this,r,i)||this;return n.pdfGradientType=e,n.contextColor=void 0,n}return u(e,t),e.prototype.apply=function(t){return f(this,void 0,void 0,(function(){var n,a,s,o,l,u,h,f,p=this;return c(this,(function(c){if(!(n=this.element.getAttribute("id")))return[2];if(void 0===this.contextColor)for(this.contextColor=null,a=this;a;){if(s=E(a.element,t.styleSheets,"color")){this.contextColor=G(s,null);break}a=a.getParent()}return o=[],l=0,u=!1,this.children.forEach((function(r){if("stop"===r.element.tagName.toLowerCase()){var i=E(r.element,t.styleSheets,"color"),n=G(E(r.element,t.styleSheets,"stop-color")||"",i?G(i,null):p.contextColor);o.push({offset:e.parseGradientOffset(r.element.getAttribute("offset")||"0"),color:[n.r,n.g,n.b]});var a=E(r.element,t.styleSheets,"stop-opacity");a&&"1"!==a&&(l+=parseFloat(a),u=!0)}})),u&&(h=new r({opacity:l/o.length})),f=new i(this.pdfGradientType,this.getCoordinates(),o,h),t.pdf.addShadingPattern(n,f),[2]}))}))},e.prototype.getBoundingBoxCore=function(t){return z(this.element,t)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return I(this,t,e)},e.parseGradientOffset=function(t){var e=parseFloat(t);return!isNaN(e)&&t.indexOf("%")>=0?e/100:e},e}(_),Q=function(t){function e(e,r){return t.call(this,"axial",e,r)||this}return u(e,t),e.prototype.getCoordinates=function(){return[parseFloat(this.element.getAttribute("x1")||"0"),parseFloat(this.element.getAttribute("y1")||"0"),parseFloat(this.element.getAttribute("x2")||"1"),parseFloat(this.element.getAttribute("y2")||"0")]},e}($),K=function(t){function e(e,r){return t.call(this,"radial",e,r)||this}return u(e,t),e.prototype.getCoordinates=function(){var t=this.element.getAttribute("cx"),e=this.element.getAttribute("cy"),r=this.element.getAttribute("fx"),i=this.element.getAttribute("fy");return[parseFloat(r||t||"0.5"),parseFloat(i||e||"0.5"),0,parseFloat(t||"0.5"),parseFloat(e||"0.5"),parseFloat(this.element.getAttribute("r")||"0.5")]},e}($),J=function(){function t(t,e){this.key=t,this.gradient=e}return t.prototype.getFillData=function(t,e){return f(this,void 0,void 0,(function(){var r,i,n;return c(this,(function(a){switch(a.label){case 0:return[4,e.refsHandler.getRendered(this.key,null,(function(t){return t.apply(new v(e.pdf,{refsHandler:e.refsHandler,textMeasure:e.textMeasure,styleSheets:e.styleSheets,viewport:e.viewport,svg2pdfParameters:e.svg2pdfParameters}))}))];case 1:return a.sent(),this.gradient.element.hasAttribute("gradientUnits")&&"objectboundingbox"!==this.gradient.element.getAttribute("gradientUnits").toLowerCase()?r=e.pdf.unitMatrix:(i=t.getBoundingBox(e),r=e.pdf.Matrix(i[2],0,0,i[3],i[0],i[1])),n=X(E(this.gradient.element,e.styleSheets,"gradientTransform","transform"),e),[2,{key:this.key,matrix:e.pdf.matrixMult(n,r)}]}}))}))},t}(),Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.apply=function(t){return f(this,void 0,void 0,(function(){var e,r,i,a,s;return c(this,(function(o){switch(o.label){case 0:if(!(e=this.element.getAttribute("id")))return[2];r=this.getBoundingBox(t),i=new n([r[0],r[1],r[0]+r[2],r[1]+r[3]],r[2],r[3]),t.pdf.beginTilingPattern(i),a=0,s=this.children,o.label=1;case 1:return a<s.length?[4,s[a].render(new v(t.pdf,{attributeState:t.attributeState,refsHandler:t.refsHandler,styleSheets:t.styleSheets,viewport:t.viewport,svg2pdfParameters:t.svg2pdfParameters}))]:[3,4];case 2:o.sent(),o.label=3;case 3:return a++,[3,1];case 4:return t.pdf.endTilingPattern(e,i),[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){return z(this.element,t)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return I(this,t,e)},e}(_),tt=function(){function t(t,e){this.key=t,this.pattern=e}return t.prototype.getFillData=function(t,e){return f(this,void 0,void 0,(function(){var r,i,n,a,s,o,l,u,h,f,p,d;return c(this,(function(c){switch(c.label){case 0:return[4,e.refsHandler.getRendered(this.key,null,(function(t){return t.apply(new v(e.pdf,{refsHandler:e.refsHandler,textMeasure:e.textMeasure,styleSheets:e.styleSheets,viewport:e.viewport,svg2pdfParameters:e.svg2pdfParameters}))}))];case 1:return c.sent(),r={key:this.key,boundingBox:void 0,xStep:0,yStep:0,matrix:void 0},n=e.pdf.unitMatrix,this.pattern.element.hasAttribute("patternUnits")&&"objectboundingbox"!==this.pattern.element.getAttribute("patternUnits").toLowerCase()||(i=t.getBoundingBox(e),n=e.pdf.Matrix(1,0,0,1,i[0],i[1]),s=this.pattern.getBoundingBox(e),o=s[0]*i[0]||0,l=s[1]*i[1]||0,u=s[2]*i[2]||0,h=s[3]*i[3]||0,r.boundingBox=[o,l,o+u,l+h],r.xStep=u,r.yStep=h),a=e.pdf.unitMatrix,this.pattern.element.hasAttribute("patternContentUnits")&&"objectboundingbox"===this.pattern.element.getAttribute("patternContentUnits").toLowerCase()&&(i||(i=t.getBoundingBox(e)),a=e.pdf.Matrix(i[2],0,0,i[3],0,0),s=r.boundingBox||this.pattern.getBoundingBox(e),o=s[0]/i[0]||0,l=s[1]/i[1]||0,u=s[2]/i[2]||0,h=s[3]/i[3]||0,r.boundingBox=[o,l,o+u,l+h],r.xStep=u,r.yStep=h),f=e.pdf.unitMatrix,(p=E(this.pattern.element,e.styleSheets,"patternTransform","transform"))&&(f=X(p,e)),d=a,d=e.pdf.matrixMult(d,n),d=e.pdf.matrixMult(d,f),d=e.pdf.matrixMult(d,e.transform),r.matrix=d,[2,r]}}))}))},t}();function et(t,r,i){var n=i||r.element,a=E(n,t.styleSheets,"color");if(a){var s=G(a,t.attributeState.color);s.ok?t.attributeState.color=s:t.attributeState.color=new p("rgb(0,0,0)")}var o=E(n,t.styleSheets,"visibility");o&&(t.attributeState.visibility=o);var l=E(n,t.styleSheets,"fill");l&&(t.attributeState.fill=function(t,e){var r=g.exec(t);if(r){var i=r[1],n=e.refsHandler.get(i);return n&&(n instanceof Q||n instanceof K)?new J(i,n):n&&n instanceof Z?new tt(i,n):new d(new p("rgb(0, 0, 0)"))}var a=G(t,e.attributeState.color);return a.ok?new d(a):null}(l,t));var u=E(n,t.styleSheets,"fill-opacity");u&&(t.attributeState.fillOpacity=parseFloat(u));var h=E(n,t.styleSheets,"stroke-opacity");h&&(t.attributeState.strokeOpacity=parseFloat(h));var f=E(n,t.styleSheets,"opacity");f&&(t.attributeState.opacity=parseFloat(f));var c=E(n,t.styleSheets,"stroke-width");void 0!==c&&""!==c&&(t.attributeState.strokeWidth=Math.abs(parseFloat(c)));var m=E(n,t.styleSheets,"stroke");if(m)if("none"===m)t.attributeState.stroke=null;else{var y=G(m,t.attributeState.color);y.ok&&(t.attributeState.stroke=new d(y))}var b=E(n,t.styleSheets,"stroke-linecap");b&&(t.attributeState.strokeLinecap=b);var v=E(n,t.styleSheets,"stroke-linejoin");v&&(t.attributeState.strokeLinejoin=v);var x=E(n,t.styleSheets,"stroke-dasharray");if(x){var S=parseInt(E(n,t.styleSheets,"stroke-dashoffset")||"0");t.attributeState.strokeDasharray=W(x),t.attributeState.strokeDashoffset=S}var w=E(n,t.styleSheets,"stroke-miterlimit");void 0!==w&&""!==w&&(t.attributeState.strokeMiterlimit=parseFloat(w));var k=n.getAttribute("xml:space");k&&(t.attributeState.xmlSpace=k);var M=E(n,t.styleSheets,"font-weight");M&&(t.attributeState.fontWeight=M);var T=E(n,t.styleSheets,"font-style");T&&(t.attributeState.fontStyle=T);var C=E(n,t.styleSheets,"font-family");if(C){var F=e.parse(C);t.attributeState.fontFamily=function(t,e,r){var i="";"bold"===t.fontWeight&&(i="bold"),"italic"===t.fontStyle&&(i+="italic"),""===i&&(i="normal");var n=r.pdf.getFontList(),a="";return e.some((function(t){var e=n[t];return e&&e.indexOf(i)>=0?(a=t,!0):(t=t.toLowerCase(),!!j.hasOwnProperty(t)&&(a=t,!0))}))||(a="times"),a}(t.attributeState,F,t)}var A=E(n,t.styleSheets,"font-size");if(A){var P=t.pdf.getFontSize();t.attributeState.fontSize=R(A,P)}var B=E(n,t.styleSheets,"vertical-align")||E(n,t.styleSheets,"alignment-baseline");if(B){var N=B.match(/(baseline|text-bottom|alphabetic|ideographic|middle|central|mathematical|text-top|bottom|center|top|hanging)/);N&&(t.attributeState.alignmentBaseline=N[0])}var O=E(n,t.styleSheets,"text-anchor");O&&(t.attributeState.textAnchor=O)}function rt(t,e,i){var n=1,a=1;n*=t.attributeState.fillOpacity,n*=t.attributeState.opacity,t.attributeState.fill instanceof d&&void 0!==t.attributeState.fill.color.a&&(n*=t.attributeState.fill.color.a),a*=t.attributeState.strokeOpacity,a*=t.attributeState.opacity,t.attributeState.stroke instanceof d&&void 0!==t.attributeState.stroke.color.a&&(a*=t.attributeState.stroke.color.a);var s,o,l=n<1,u=a<1;if(O(i,"use")?(l=!0,u=!0,n*=t.attributeState.fill?1:0,a*=t.attributeState.stroke?1:0):t.withinUse&&(t.attributeState.fill!==e.attributeState.fill?(l=!0,n*=t.attributeState.fill?1:0):l&&!t.attributeState.fill&&(n=0),t.attributeState.stroke!==e.attributeState.stroke?(u=!0,a*=t.attributeState.stroke?1:0):u&&!t.attributeState.stroke&&(a=0)),l||u){var h={};l&&(h.opacity=n),u&&(h["stroke-opacity"]=a),t.pdf.setGState(new r(h))}if(t.attributeState.fill&&t.attributeState.fill!==e.attributeState.fill&&t.attributeState.fill instanceof d&&t.attributeState.fill.color.ok&&!O(i,"text")&&t.pdf.setFillColor(t.attributeState.fill.color.r,t.attributeState.fill.color.g,t.attributeState.fill.color.b),t.attributeState.strokeWidth!==e.attributeState.strokeWidth&&t.pdf.setLineWidth(t.attributeState.strokeWidth),t.attributeState.stroke!==e.attributeState.stroke&&t.attributeState.stroke instanceof d&&t.pdf.setDrawColor(t.attributeState.stroke.color.r,t.attributeState.stroke.color.g,t.attributeState.stroke.color.b),t.attributeState.strokeLinecap!==e.attributeState.strokeLinecap&&t.pdf.setLineCap(t.attributeState.strokeLinecap),t.attributeState.strokeLinejoin!==e.attributeState.strokeLinejoin&&t.pdf.setLineJoin(t.attributeState.strokeLinejoin),t.attributeState.strokeDasharray===e.attributeState.strokeDasharray&&t.attributeState.strokeDashoffset===e.attributeState.strokeDashoffset||!t.attributeState.strokeDasharray||t.pdf.setLineDashPattern(t.attributeState.strokeDasharray,t.attributeState.strokeDashoffset),t.attributeState.strokeMiterlimit!==e.attributeState.strokeMiterlimit&&t.pdf.setLineMiterLimit(t.attributeState.strokeMiterlimit),t.attributeState.fontFamily!==e.attributeState.fontFamily&&(s=j.hasOwnProperty(t.attributeState.fontFamily)?j[t.attributeState.fontFamily]:t.attributeState.fontFamily),t.attributeState.fill&&t.attributeState.fill!==e.attributeState.fill&&t.attributeState.fill instanceof d&&t.attributeState.fill.color.ok){var f=t.attributeState.fill.color;t.pdf.setTextColor(f.r,f.g,f.b)}t.attributeState.fontWeight===e.attributeState.fontWeight&&t.attributeState.fontStyle===e.attributeState.fontStyle||(o="","bold"===t.attributeState.fontWeight&&(o="bold"),"italic"===t.attributeState.fontStyle&&(o+="italic"),""===o&&(o="normal")),void 0===s&&void 0===o||(void 0===s&&(s=j.hasOwnProperty(t.attributeState.fontFamily)?j[t.attributeState.fontFamily]:t.attributeState.fontFamily),t.pdf.setFont(s,o)),t.attributeState.fontSize!==e.attributeState.fontSize&&t.pdf.setFontSize(t.attributeState.fontSize*t.pdf.internal.scaleFactor)}function it(t,e){var r=E(t.element,e.styleSheets,"clip-path");if(r){var i=g.exec(r);if(i){var n=i[1];return e.refsHandler.get(n)||void 0}}}function nt(t,e,r){return f(this,void 0,void 0,(function(){var i,n;return c(this,(function(a){switch(a.label){case 0:return i=r.clone(),e.element.hasAttribute("clipPathUnits")&&"objectboundingbox"===e.element.getAttribute("clipPathUnits").toLowerCase()&&(n=t.getBoundingBox(r),i.transform=r.pdf.matrixMult(r.pdf.Matrix(n[2],0,0,n[3],n[0],n[1]),r.transform)),[4,e.apply(i)];case 1:return a.sent(),[2]}}))}))}var at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.render=function(t){return f(this,void 0,void 0,(function(){var e,r,i;return c(this,(function(n){switch(n.label){case 0:return this.isVisible("hidden"!==t.attributeState.visibility,t)?((e=t.clone()).transform=e.pdf.matrixMult(this.computeNodeTransform(e),t.transform),et(e,this),(r=this.element.hasAttribute("clip-path")&&"none"!==E(this.element,e.styleSheets,"clip-path"))?(i=it(this,e))&&i.isVisible(!0,e)?(e.pdf.saveGraphicsState(),[4,nt(this,i,e)]):[3,2]:[3,3]):[2];case 1:return n.sent(),[3,3];case 2:return[2];case 3:return e.withinClipPath||e.pdf.saveGraphicsState(),rt(e,t,this.element),[4,this.renderCore(e)];case 4:return n.sent(),e.withinClipPath||e.pdf.restoreGraphicsState(),r&&e.pdf.restoreGraphicsState(),[2]}}))}))},e}(q),st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e}(at),ot=function(t){function e(e,r,i){var n=t.call(this,r,i)||this;return n.cachedPath=null,n.hasMarkers=e,n}return u(e,t),e.prototype.renderCore=function(t){return f(this,void 0,void 0,(function(){var e;return c(this,(function(r){switch(r.label){case 0:return null===(e=this.getCachedPath(t))||0===e.segments.length?[2]:(t.withinClipPath?e.transform(t.transform):t.pdf.setCurrentTransformationMatrix(t.transform),e.draw(t),[4,this.fillOrStroke(t)]);case 1:return r.sent(),this.hasMarkers?[4,this.drawMarkers(t,e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},e.prototype.getCachedPath=function(t){return this.cachedPath||(this.cachedPath=this.getPath(t))},e.prototype.drawMarkers=function(t,e){return f(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.getMarkers(e,t).draw(t.clone({transform:t.pdf.unitMatrix}))];case 1:return r.sent(),[2]}}))}))},e.prototype.fillOrStroke=function(t){return f(this,void 0,void 0,(function(){var e,r,i,n,a;return c(this,(function(s){switch(s.label){case 0:return t.withinClipPath?[2]:(e=t.attributeState.fill,r=t.attributeState.stroke&&0!==t.attributeState.strokeWidth,e?[4,e.getFillData(this,t)]:[3,2]);case 1:return n=s.sent(),[3,3];case 2:n=void 0,s.label=3;case 3:return i=n,a="evenodd"===E(this.element,t.styleSheets,"fill-rule"),e&&r||t.withinUse?a?t.pdf.fillStrokeEvenOdd(i):t.pdf.fillStroke(i):e?a?t.pdf.fillEvenOdd(i):t.pdf.fill(i):r?t.pdf.stroke():t.pdf.discardPath(),[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){var e=this.getCachedPath(t);if(!e)return[0,0,0,0];for(var r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,s=0,o=0,l=0;l<e.segments.length;l++){var u=e.segments[l];(u instanceof A||u instanceof P||u instanceof B)&&(s=u.x,o=u.y),u instanceof B?(r=Math.min(r,s,u.x1,u.x2,u.x),n=Math.max(n,s,u.x1,u.x2,u.x),i=Math.min(i,o,u.y1,u.y2,u.y),a=Math.max(a,o,u.y1,u.y2,u.y)):(r=Math.min(r,s),n=Math.max(n,s),i=Math.min(i,o),a=Math.max(a,o))}return[r,i,n-r,a-i]},e.prototype.getMarkers=function(t,e){var r=E(this.element,e.styleSheets,"marker-start"),i=E(this.element,e.styleSheets,"marker-mid"),n=E(this.element,e.styleSheets,"marker-end"),a=new H;if(r||i||n){n&&(n=lt(n)),r&&(r=lt(r)),i&&(i=lt(i));for(var s=t.segments,o=[1,0],l=void 0,u=!1,h=[1,0],f=!1,c=function(t){var e=s[t],c=r&&(1===t||!(s[t]instanceof A)&&s[t-1]instanceof A);c&&s.forEach((function(e,r){if(!f&&e instanceof N&&r>t){var i=s[r-1];f=(i instanceof A||i instanceof P||i instanceof B)&&i}}));var p=n&&(t===s.length-1||!(s[t]instanceof A)&&s[t+1]instanceof A),d=i&&t>0&&!(1===t&&s[t-1]instanceof A),m=s[t-1]||null;if(m instanceof A||m instanceof P||m instanceof B){if(e instanceof B)c&&a.addMarker(new V(r,[m.x,m.y],S(f?[f.x,f.y]:[m.x,m.y],[e.x1,e.y1]))),p&&a.addMarker(new V(n,[e.x,e.y],S([e.x2,e.y2],[e.x,e.y]))),d&&(l=M([m.x,m.y],[e.x1,e.y1]),l=m instanceof A?l:k(T(o,l)),a.addMarker(new V(i,[m.x,m.y],Math.atan2(l[1],l[0])))),o=M([e.x2,e.y2],[e.x,e.y]);else if(e instanceof A||e instanceof P){if(l=M([m.x,m.y],[e.x,e.y]),c){var g=f?M([f.x,f.y],[e.x,e.y]):l;a.addMarker(new V(r,[m.x,m.y],Math.atan2(g[1],g[0])))}if(p&&a.addMarker(new V(n,[e.x,e.y],Math.atan2(l[1],l[0]))),d){g=e instanceof A?o:m instanceof A?l:k(T(o,l));a.addMarker(new V(i,[m.x,m.y],Math.atan2(g[1],g[0])))}o=l}else if(e instanceof N){if(l=M([m.x,m.y],[u.x,u.y]),d){g=m instanceof A?l:k(T(o,l));a.addMarker(new V(i,[m.x,m.y],Math.atan2(g[1],g[0])))}if(p){g=k(T(l,h));a.addMarker(new V(n,[u.x,u.y],Math.atan2(g[1],g[0])))}o=l}}else{u=e instanceof A&&e;var y=s[t+1];(y instanceof A||y instanceof P||y instanceof B)&&(h=M([u.x,u.y],[y.x,y.y]))}},p=0;p<s.length;p++)c(p)}return a},e}(st);function lt(t){var e=g.exec(t);return e&&e[1]||void 0}var ut=function(t){function e(e,r){return t.call(this,!0,e,r)||this}return u(e,t),e.prototype.getPath=function(t){if(t.withinClipPath||null===t.attributeState.stroke)return null;var e=parseFloat(this.element.getAttribute("x1")||"0"),r=parseFloat(this.element.getAttribute("y1")||"0"),i=parseFloat(this.element.getAttribute("x2")||"0"),n=parseFloat(this.element.getAttribute("y2")||"0");return e||i||r||n?(new F).moveTo(e,r).lineTo(i,n):null},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return L(this,t,e)},e.prototype.fillOrStroke=function(e){return f(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return e.attributeState.fill=null,[4,t.prototype.fillOrStroke.call(this,e)];case 1:return r.sent(),[2]}}))}))},e}(ot),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.apply=function(t){return f(this,void 0,void 0,(function(){var e,r,i,n;return c(this,(function(a){switch(a.label){case 0:return this.isVisible("hidden"!==t.attributeState.visibility,t)?((e=t.clone()).transform=e.pdf.unitMatrix,et(e,this),this.element.hasAttribute("clip-path")&&"none"!==E(this.element,e.styleSheets,"clip-path")?(r=it(this,e))&&r.isVisible(!0,e)?[4,nt(this,r,e)]:[3,2]:[3,3]):[2];case 1:return a.sent(),[3,3];case 2:return[2];case 3:rt(e,t,this.element),i=0,n=this.children,a.label=4;case 4:return i<n.length?[4,n[i].render(e)]:[3,7];case 5:a.sent(),a.label=6;case 6:return i++,[3,4];case 7:return[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){return U(t,this)},e.prototype.isVisible=function(t,e){return I(this,t,e)},e.prototype.computeNodeTransformCore=function(t){var e=parseFloat(E(this.element,t.styleSheets,"x")||"0"),r=parseFloat(E(this.element,t.styleSheets,"y")||"0"),i=this.element.getAttribute("viewBox");if(i){var n=W(i),a=parseFloat(E(this.element,t.styleSheets,"width")||E(this.element.ownerSVGElement,t.styleSheets,"width")||i[2]),s=parseFloat(E(this.element,t.styleSheets,"height")||E(this.element.ownerSVGElement,t.styleSheets,"height")||i[3]);return Y(this.element,n,e,r,a,s,t)}return t.pdf.Matrix(1,0,0,1,e,r)},e}(_),ft=function(t,e){this.width=t,this.height=e},ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.renderCore=function(t){return f(this,void 0,void 0,(function(){var r,i,n,a,s,o,l,u,h,f,p,d,m;return c(this,(function(c){switch(c.label){case 0:return r=parseFloat,(i=this.element.getAttribute("href")||this.element.getAttribute("xlink:href"))?(n=i.substring(1),a=t.refsHandler.get(n),s=O(a.element,"symbol,svg")&&a.element.hasAttribute("viewBox"),o=r(E(this.element,t.styleSheets,"x")||"0"),l=r(E(this.element,t.styleSheets,"y")||"0"),u=void 0,h=void 0,s?(u=r(E(this.element,t.styleSheets,"width")||E(a.element,t.styleSheets,"width")||"0"),h=r(E(this.element,t.styleSheets,"height")||E(a.element,t.styleSheets,"height")||"0"),o+=r(E(a.element,t.styleSheets,"x")||"0"),l+=r(E(a.element,t.styleSheets,"y")||"0"),p=W(a.element.getAttribute("viewBox")),f=Y(a.element,p,o,l,u,h,t)):f=t.pdf.Matrix(1,0,0,1,o,l),d=new v(t.pdf,{refsHandler:t.refsHandler,styleSheets:t.styleSheets,withinUse:!0,viewport:s?new ft(u,h):t.viewport,svg2pdfParameters:t.svg2pdfParameters}),m=t.attributeState.color,[4,t.refsHandler.getRendered(n,m,(function(t){return e.renderReferencedNode(t,n,m,d)}))]):[2];case 1:return c.sent(),t.pdf.saveGraphicsState(),t.pdf.setCurrentTransformationMatrix(t.transform),s&&"visible"!==E(a.element,t.styleSheets,"overflow")&&(t.pdf.rect(o,l,u,h),t.pdf.clip().discardPath()),t.pdf.doFormObject(x.generateKey(n,m),f),t.pdf.restoreGraphicsState(),[2]}}))}))},e.renderReferencedNode=function(t,e,r,i){return f(this,void 0,void 0,(function(){var n;return c(this,(function(a){switch(a.label){case 0:return n=[(n=t.getBoundingBox(i))[0]-.5*n[2],n[1]-.5*n[3],2*n[2],2*n[3]],i.attributeState.color=r,i.pdf.beginFormObject(n[0],n[1],n[2],n[3],i.pdf.unitMatrix),t instanceof ht?[4,t.apply(i)]:[3,2];case 1:return a.sent(),[3,4];case 2:return[4,t.render(i)];case 3:a.sent(),a.label=4;case 4:return i.pdf.endFormObject(x.generateKey(e,r)),[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){return z(this.element,t)},e.prototype.isVisible=function(t,e){return L(this,t,e)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e}(st),pt=function(t){function e(e,r){return t.call(this,!1,e,r)||this}return u(e,t),e.prototype.getPath=function(t){var e=parseFloat(E(this.element,t.styleSheets,"width")||"0"),r=parseFloat(E(this.element,t.styleSheets,"height")||"0");if(!isFinite(e)||e<=0||!isFinite(r)||r<=0)return null;var i=E(this.element,t.styleSheets,"rx"),n=E(this.element,t.styleSheets,"ry"),a=Math.min(parseFloat(i||n||"0"),.5*e),s=Math.min(parseFloat(n||i||"0"),.5*r),o=parseFloat(E(this.element,t.styleSheets,"x")||"0"),l=parseFloat(E(this.element,t.styleSheets,"y")||"0"),u=4/3*(Math.SQRT2-1);return 0===a&&0===s?(new F).moveTo(o,l).lineTo(o+e,l).lineTo(o+e,l+r).lineTo(o,l+r).close():(new F).moveTo(o+=a,l).lineTo(o+=e-2*a,l).curveTo(o+a*u,l,o+a,l+(s-s*u),o+=a,l+=s).lineTo(o,l+=r-2*s).curveTo(o,l+s*u,o-a*u,l+s,o-=a,l+=s).lineTo(o+=2*a-e,l).curveTo(o-a*u,l,o-a,l-s*u,o-=a,l-=s).lineTo(o,l+=2*s-r).curveTo(o,l-s*u,o+a*u,l-s,o+=a,l-=s).close()},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return L(this,t,e)},e}(ot),dt=function(t){function e(e,r){return t.call(this,!1,e,r)||this}return u(e,t),e.prototype.getPath=function(t){var e=this.getRx(t),r=this.getRy(t);if(!isFinite(e)||r<=0||!isFinite(r)||r<=0)return null;var i=parseFloat(E(this.element,t.styleSheets,"cx")||"0"),n=parseFloat(E(this.element,t.styleSheets,"cy")||"0"),a=4/3*(Math.SQRT2-1)*e,s=4/3*(Math.SQRT2-1)*r;return(new F).moveTo(i+e,n).curveTo(i+e,n-s,i+a,n-r,i,n-r).curveTo(i-a,n-r,i-e,n-s,i-e,n).curveTo(i-e,n+s,i-a,n+r,i,n+r).curveTo(i+a,n+r,i+e,n+s,i+e,n)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return L(this,t,e)},e}(ot),mt=function(t){function e(e,r){return t.call(this,e,r)||this}return u(e,t),e.prototype.getRx=function(t){return parseFloat(E(this.element,t.styleSheets,"rx")||"0")},e.prototype.getRy=function(t){return parseFloat(E(this.element,t.styleSheets,"ry")||"0")},e}(dt);function gt(t){var e="invisible";return t.fill&&t.stroke?e="fillThenStroke":t.fill?e="fill":t.stroke&&(e="stroke"),e}function yt(t){return t.replace(/[\n\r]/g,"")}function bt(t){return t.replace(/[\t]/g," ")}function vt(t){return t.replace(/ +/g," ")}function xt(t,e,r){switch(E(t,r.styleSheets,"text-transform")){case"uppercase":return e.toUpperCase();case"lowercase":return e.toLowerCase();default:return e}}var St=function(){function t(t,e,r,i){this.textNode=t,this.texts=[],this.textNodes=[],this.contexts=[],this.textAnchor=e,this.originX=r,this.originY=i,this.textMeasures=[]}return t.prototype.setX=function(t){this.originX=t},t.prototype.setY=function(t){this.originY=t},t.prototype.add=function(t,e,r){this.texts.push(e),this.textNodes.push(t),this.contexts.push(r)},t.prototype.rightTrimText=function(){for(var t=this.texts.length-1;t>=0;t--)if("default"===this.contexts[t].attributeState.xmlSpace&&(this.texts[t]=this.texts[t].replace(/\s+$/,"")),this.texts[t].match(/[^\s]/))return!1;return!0},t.prototype.measureText=function(t){for(var e=0;e<this.texts.length;e++)this.textMeasures.push({width:t.textMeasure.measureTextWidth(this.texts[e],this.contexts[e].attributeState),length:this.texts[e].length})},t.prototype.put=function(t,e){var r,i,n,a,s=[],o=[],l=[],u=this.originX,h=this.originY,f=u,c=u;for(r=0;r<this.textNodes.length;r++){i=this.textNodes[r],n=this.contexts[r],a=this.textMeasures[r]||{width:t.textMeasure.measureTextWidth(this.texts[r],this.contexts[r].attributeState),length:this.texts[r].length};var p=u,d=h;if("#text"!==i.nodeName&&!s.includes(i)){s.push(i);var m=i.getAttribute("dx");null!==m&&(p+=R(m,n.attributeState.fontSize));var g=i.getAttribute("dy");null!==g&&(d+=R(g,n.attributeState.fontSize))}o[r]=p,l[r]=d,u=p+a.width+a.length*e,h=d,f=Math.min(f,p),c=Math.max(c,u)}var y=0;switch(this.textAnchor){case"start":y=0;break;case"middle":y=(c-f)/2;break;case"end":y=c-f}for(r=0;r<this.textNodes.length;r++)if(i=this.textNodes[r],n=this.contexts[r],"#text"===i.nodeName||"hidden"!==n.attributeState.visibility){t.pdf.saveGraphicsState(),rt(n,t,i);var b=n.attributeState.alignmentBaseline,v=gt(n.attributeState);t.pdf.text(this.texts[r],o[r]-y,l[r],{baseline:D(b),angle:t.transform,renderingMode:"fill"===v?void 0:v,charSpace:0===e?void 0:e}),t.pdf.restoreGraphicsState()}return[u,h]},t}(),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.processTSpans=function(t,e,r,i,n,a){for(var s=r.pdf.getFontSize(),o=r.attributeState.xmlSpace,l=!0,u=!1,h=0;h<e.childNodes.length;h++){var f=e.childNodes[h];if(f.textContent){var c=f.textContent;if("#text"===f.nodeName){var p=yt(c);p=bt(p),"default"===o&&(p=vt(p),l&&p.match(/^\s/)&&(u=!0),p.match(/[^\s]/)&&(l=!1),a.prevText.match(/\s$/)&&(p=p.replace(/^\s+/,"")));var d=xt(e,p,r);n.add(e,d,r),a.prevText=c,a.prevContext=r}else if(O(f,"title"));else if(O(f,"tspan")){var m=f,g=m.getAttribute("x");if(null!==g){var y=R(g,s);n=new St(this,E(m,r.styleSheets,"text-anchor")||r.attributeState.textAnchor,y,0),i.push({type:"y",chunk:n})}var b=m.getAttribute("y");if(null!==b){var v=R(b,s);n=new St(this,E(m,r.styleSheets,"text-anchor")||r.attributeState.textAnchor,0,v),i.push({type:"x",chunk:n})}var x=r.clone();et(x,t,m),this.processTSpans(t,m,x,i,n,a)}}}return u},e.prototype.renderCore=function(t){return f(this,void 0,void 0,(function(){var e,r,i,n,a,s,o,l,u,h,f,p,d,m,g,y,b,v,x,S,w,k,M;return c(this,(function(c){if(t.pdf.saveGraphicsState(),e=0,r=0,i=1,n=t.pdf.getFontSize(),a=R(this.element.getAttribute("x"),n),s=R(this.element.getAttribute("y"),n),o=R(this.element.getAttribute("dx"),n),l=R(this.element.getAttribute("dy"),n),u=parseFloat(this.element.getAttribute("textLength")||"0"),h=t.attributeState.visibility,0===this.element.childElementCount)f=this.element.textContent||"",p=function(t,e){return t=bt(t=yt(t)),"default"===e.xmlSpace&&(t=vt(t=t.trim())),t}(f,t.attributeState),d=xt(this.element,p,t),e=t.textMeasure.getTextOffset(d,t.attributeState),u>0&&(m=t.textMeasure.measureTextWidth(d,t.attributeState),"default"===t.attributeState.xmlSpace&&f.match(/^\s/)&&(i=0),r=(u-m)/(d.length-i)||0),"visible"===h&&(g=t.attributeState.alignmentBaseline,y=gt(t.attributeState),t.pdf.text(d,a+o-e,s+l,{baseline:D(g),angle:t.transform,renderingMode:"fill"===y?void 0:y,charSpace:0===r?void 0:r}));else{for(b=[],v=new St(this,t.attributeState.textAnchor,a+o,s+l),b.push({type:"",chunk:v}),x=this.processTSpans(this,this.element,t,b,v,{prevText:" ",prevContext:t}),i=x?0:1,S=!0,w=b.length-1;w>=0;w--)S&&(S=b[w].chunk.rightTrimText());u>0&&(k=0,M=0,b.forEach((function(e){var r=e.chunk;r.measureText(t),r.textMeasures.forEach((function(t){var e=t.width,r=t.length;k+=e,M+=r}))})),r=(u-k)/(M-i)),b.reduce((function(e,i){var n=i.type,a=i.chunk;return"x"===n?a.setX(e[0]):"y"===n&&a.setY(e[1]),a.put(t,r)}),[0,0])}return t.pdf.restoreGraphicsState(),[2]}))}))},e.prototype.isVisible=function(t,e){return I(this,t,e)},e.prototype.getBoundingBoxCore=function(t){return z(this.element,t)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e}(st),kt=function(t){function e(e,r){return t.call(this,!0,e,r)||this}return u(e,t),e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return L(this,t,e)},e.prototype.getPath=function(t){var e,r,i=new s(E(this.element,t.styleSheets,"d")||"").unshort().unarc().abs(),n=new F;return i.iterate((function(t){var i=t[0];switch(i){case"M":n.moveTo(t[1],t[2]);break;case"L":n.lineTo(t[1],t[2]);break;case"H":n.lineTo(t[1],r);break;case"V":n.lineTo(e,t[1]);break;case"C":n.curveTo(t[1],t[2],t[3],t[4],t[5],t[6]);break;case"Q":var a=w([e,r],[t[1],t[2]]),s=w([t[3],t[4]],[t[1],t[2]]);n.curveTo(a[0],a[1],s[0],s[1],t[3],t[4]);break;case"Z":n.close()}switch(i){case"M":case"L":e=t[1],r=t[2];break;case"H":e=t[1];break;case"V":r=t[1];break;case"C":e=t[5],r=t[6];break;case"Q":e=t[3],r=t[4]}})),n},e}(ot),Mt=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*\s*)$/i,Tt=function(t){function e(r,i){var n=t.call(this,r,i)||this;return n.imageLoadingPromise=null,n.imageUrl=n.element.getAttribute("xlink:href")||n.element.getAttribute("href"),n.imageUrl&&(n.imageLoadingPromise=e.fetchImageData(n.imageUrl)),n}return u(e,t),e.prototype.renderCore=function(t){return f(this,void 0,void 0,(function(){var e,r,i,n,a,s,o,l,u,h,f,p;return c(this,(function(c){switch(c.label){case 0:return this.imageLoadingPromise?(t.pdf.setCurrentTransformationMatrix(t.transform),e=parseFloat(E(this.element,t.styleSheets,"width")||"0"),r=parseFloat(E(this.element,t.styleSheets,"height")||"0"),i=parseFloat(E(this.element,t.styleSheets,"x")||"0"),n=parseFloat(E(this.element,t.styleSheets,"y")||"0"),!isFinite(e)||e<=0||!isFinite(r)||r<=0?[2]:[4,this.imageLoadingPromise]):[2];case 1:return a=c.sent(),s=a.data,0!==(o=a.format).indexOf("svg")?[3,3]:(l=new DOMParser,u=l.parseFromString(s,"image/svg+xml").firstElementChild,(!(h=this.element.getAttribute("preserveAspectRatio"))||h.indexOf("defer")<0||!u.getAttribute("preserveAspectRatio"))&&u.setAttribute("preserveAspectRatio",h||""),u.setAttribute("x",String(i)),u.setAttribute("y",String(n)),u.setAttribute("width",String(e)),u.setAttribute("height",String(r)),[4,Ht(u,f={}).render(new v(t.pdf,{refsHandler:new x(f),styleSheets:t.styleSheets,viewport:new ft(e,r),svg2pdfParameters:t.svg2pdfParameters}))]);case 2:return c.sent(),[2];case 3:p="data:image/"+o+";base64,"+btoa(s);try{t.pdf.addImage(p,"",i,n,e,r)}catch(t){"object"==typeof console&&console.warn&&console.warn("Could not load image "+this.imageUrl+".\n"+t)}c.label=4;case 4:return[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){return z(this.element,t)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return L(this,t,e)},e.fetchImageData=function(t){return f(this,void 0,void 0,(function(){var r,i,n,a,s;return c(this,(function(o){switch(o.label){case 0:if(!(n=t.match(Mt)))return[3,1];if(a=n[2],"image"!==(s=a.split("/"))[0])throw new Error("Unsupported image URL: "+t);return i=s[1],r=n[5],r="base64"===n[4]?atob(r):decodeURIComponent(r),[3,3];case 1:return[4,e.fetchImage(t)];case 2:r=o.sent(),i=t.substring(t.lastIndexOf(".")+1),o.label=3;case 3:return[2,{data:r,format:i}]}}))}))},e.fetchImage=function(t){return new Promise((function(e,r){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){if(200!==i.status)throw new Error("Error "+i.status+": Failed to load image '"+t+"'");for(var r=new Uint8Array(i.response),n="",a=0;a<r.length;a++)n+=String.fromCharCode(r[a]);e(n)},i.onerror=r,i.onabort=r,i.send(null)}))},e.getMimeType=function(t){switch(t=t.toLowerCase()){case"jpg":case"jpeg":return"image/jpeg";default:return"image/"+t}},e}(st),Ct=function(t){function e(e,r,i){var n=t.call(this,!0,r,i)||this;return n.closed=e,n}return u(e,t),e.prototype.getPath=function(t){if(!this.element.hasAttribute("points")||""===this.element.getAttribute("points"))return null;var r=e.parsePointsString(this.element.getAttribute("points")),i=new F;if(r.length<1)return i;i.moveTo(r[0][0],r[0][1]);for(var n=1;n<r.length;n++)i.lineTo(r[n][0],r[n][1]);return this.closed&&i.close(),i},e.prototype.isVisible=function(t,e){return L(this,t,e)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.parsePointsString=function(t){for(var e=W(t),r=[],i=0;i<e.length-1;i+=2){var n=e[i],a=e[i+1];r.push([n,a])}return r},e}(ot),Ft=function(t){function e(e,r){return t.call(this,!0,e,r)||this}return u(e,t),e}(Ct),At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.render=function(t){return Promise.resolve()},e.prototype.getBoundingBoxCore=function(t){return[0,0,0,0]},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e.prototype.isVisible=function(t,e){return L(this,t,e)},e}(q),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.apply=function(t){return f(this,void 0,void 0,(function(){var e,r,i,n;return c(this,(function(a){switch(a.label){case 0:e=this.computeNodeTransform(t),r=this.getBoundingBox(t),t.pdf.beginFormObject(r[0],r[1],r[2],r[3],e),i=0,n=this.children,a.label=1;case 1:return i<n.length?[4,n[i].render(new v(t.pdf,{refsHandler:t.refsHandler,styleSheets:t.styleSheets,viewport:t.viewport,svg2pdfParameters:t.svg2pdfParameters}))]:[3,4];case 2:a.sent(),a.label=3;case 3:return i++,[3,1];case 4:return t.pdf.endFormObject(this.element.getAttribute("id")),[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){var e,r=this.element.getAttribute("viewBox");return r&&(e=W(r)),[e&&e[0]||0,e&&e[1]||0,e&&e[2]||parseFloat(this.element.getAttribute("marker-width")||"0"),e&&e[3]||parseFloat(this.element.getAttribute("marker-height")||"0")]},e.prototype.computeNodeTransformCore=function(t){var e,r=parseFloat(this.element.getAttribute("refX")||"0"),i=parseFloat(this.element.getAttribute("refY")||"0"),n=this.element.getAttribute("viewBox");if(n){var a=W(n);e=Y(this.element,a,0,0,parseFloat(this.element.getAttribute("markerWidth")||"3"),parseFloat(this.element.getAttribute("markerHeight")||"3"),t,!0),e=t.pdf.matrixMult(t.pdf.Matrix(1,0,0,1,-r,-i),e)}else e=t.pdf.Matrix(1,0,0,1,-r,-i);return e},e.prototype.isVisible=function(t,e){return I(this,t,e)},e}(_),Bt=function(t){function e(e,r){return t.call(this,e,r)||this}return u(e,t),e.prototype.getR=function(t){var e;return null!==(e=this.r)&&void 0!==e?e:this.r=parseFloat(E(this.element,t.styleSheets,"r")||"0")},e.prototype.getRx=function(t){return this.getR(t)},e.prototype.getRy=function(t){return this.getR(t)},e}(dt),Nt=function(t){function e(e,r){return t.call(this,!1,e,r)||this}return u(e,t),e}(Ct),Ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.renderCore=function(t){return f(this,void 0,void 0,(function(){var e,r;return c(this,(function(i){switch(i.label){case 0:e=0,r=this.children,i.label=1;case 1:return e<r.length?[4,r[e].render(t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){return U(t,this)},e}(at),Et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.isVisible=function(t,e){return I(this,t,e)},e.prototype.render=function(e){return f(this,void 0,void 0,(function(){var r,i,n,a,s;return c(this,(function(o){switch(o.label){case 0:return this.isVisible("hidden"!==e.attributeState.visibility,e)?(r=this.getX(e),i=this.getY(e),n=this.getWidth(e),a=this.getHeight(e),e.pdf.saveGraphicsState(),s=e.transform,this.element.hasAttribute("transform")&&(s=e.pdf.matrixMult(X(this.element.getAttribute("transform"),e),s)),e.pdf.setCurrentTransformationMatrix(s),e.withinUse||"visible"===E(this.element,e.styleSheets,"overflow")||e.pdf.rect(r,i,n,a).clip().discardPath(),[4,t.prototype.render.call(this,e.clone({transform:e.pdf.unitMatrix,viewport:e.withinUse?e.viewport:new ft(n,a)}))]):[2];case 1:return o.sent(),e.pdf.restoreGraphicsState(),[2]}}))}))},e.prototype.computeNodeTransform=function(t){return this.computeNodeTransformCore(t)},e.prototype.computeNodeTransformCore=function(t){if(t.withinUse)return t.pdf.unitMatrix;var e,r=this.getX(t),i=this.getY(t),n=this.getViewBox();if(n){var a=this.getWidth(t),s=this.getHeight(t);e=Y(this.element,n,r,i,a,s,t)}else e=t.pdf.Matrix(1,0,0,1,r,i);return e},e.prototype.getWidth=function(t){if(void 0!==this.width)return this.width;var e,r,i=t.svg2pdfParameters;if(this.isOutermostSvg(t))if(null!=i.width)e=i.width;else if(r=E(this.element,t.styleSheets,"width"))e=parseFloat(r);else{var n=this.getViewBox();if(n&&(null!=i.height||E(this.element,t.styleSheets,"height"))){var a=n[2]/n[3];e=this.getHeight(t)*a}else e=Math.min(300,t.viewport.width,2*t.viewport.height)}else e=(r=E(this.element,t.styleSheets,"width"))?parseFloat(r):t.viewport.width;return this.width=e},e.prototype.getHeight=function(t){if(void 0!==this.height)return this.height;var e,r,i=t.svg2pdfParameters;if(this.isOutermostSvg(t))if(null!=i.height)e=i.height;else if(r=E(this.element,t.styleSheets,"height"))e=parseFloat(r);else{var n=this.getViewBox();if(n){var a=n[2]/n[3];e=this.getWidth(t)/a}else e=Math.min(150,t.viewport.width/2,t.viewport.height)}else e=(r=E(this.element,t.styleSheets,"height"))?parseFloat(r):t.viewport.height;return this.height=e},e.prototype.getX=function(t){if(void 0!==this.x)return this.x;if(this.isOutermostSvg(t))return this.x=0;var e=E(this.element,t.styleSheets,"x");return this.x=e?parseFloat(e):0},e.prototype.getY=function(t){if(void 0!==this.y)return this.y;if(this.isOutermostSvg(t))return this.y=0;var e=E(this.element,t.styleSheets,"y");return this.y=e?parseFloat(e):0},e.prototype.getViewBox=function(){if(void 0!==this.viewBox)return this.viewBox;var t=this.element.getAttribute("viewBox");return this.viewBox=t?W(t):void 0},e.prototype.isOutermostSvg=function(t){return t.svg2pdfParameters.element===this.element},e}(Ot),Lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.isVisible=function(t,e){return I(this,t,e)},e.prototype.computeNodeTransformCore=function(t){return t.pdf.unitMatrix},e}(Ot),It=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.apply=function(t){return f(this,void 0,void 0,(function(){var e,r,i;return c(this,(function(n){switch(n.label){case 0:if(!this.isVisible(!0,t))return[2];e=t.pdf.matrixMult(this.computeNodeTransform(t),t.transform),t.pdf.setCurrentTransformationMatrix(e),r=0,i=this.children,n.label=1;case 1:return r<i.length?[4,i[r].render(new v(t.pdf,{refsHandler:t.refsHandler,styleSheets:t.styleSheets,viewport:t.viewport,withinClipPath:!0,svg2pdfParameters:t.svg2pdfParameters}))]:[3,4];case 2:n.sent(),n.label=3;case 3:return r++,[3,1];case 4:return t.pdf.clip().discardPath(),t.pdf.setCurrentTransformationMatrix(e.inversed()),[2]}}))}))},e.prototype.getBoundingBoxCore=function(t){return U(t,this)},e.prototype.isVisible=function(t,e){return I(this,t,e)},e}(_);function Ht(e,r){var i,n=[];switch(function(t,e){for(var r=[],i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];"#"!==n.nodeName.charAt(0)&&r.push(n)}for(i=0;i<r.length;i++)e(i,r[i])}(e,(function(t,e){return n.push(Ht(e,r))})),e.tagName.toLowerCase()){case"a":case"g":i=new Lt(e,n);break;case"circle":i=new Bt(e,n);break;case"clippath":i=new It(e,n);break;case"ellipse":i=new mt(e,n);break;case"lineargradient":i=new Q(e,n);break;case"image":i=new Tt(e,n);break;case"line":i=new ut(e,n);break;case"marker":i=new Pt(e,n);break;case"path":i=new kt(e,n);break;case"pattern":i=new Z(e,n);break;case"polygon":i=new Ft(e,n);break;case"polyline":i=new Nt(e,n);break;case"radialgradient":i=new K(e,n);break;case"rect":i=new pt(e,n);break;case"svg":i=new Et(e,n);break;case"symbol":i=new ht(e,n);break;case"text":i=new wt(e,n);break;case"use":i=new ct(e,n);break;default:i=new At(e,n)}if(null!=r&&i.element.hasAttribute("id")){var a=t(i.element.id,{isIdentifier:!0});r[a]=r[a]||i}return i.children.forEach((function(t){return t.setParent(i)})),i}var Vt=function(){function t(t,e){this.rootSvg=t,this.loadExternalSheets=e,this.styleSheets=[]}return t.prototype.load=function(){return f(this,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return[4,this.collectStyleSheetTexts()];case 1:return t=e.sent(),this.parseCssSheets(t),[2]}}))}))},t.prototype.collectStyleSheetTexts=function(){return f(this,void 0,void 0,(function(){var e,r,i,n,a;return c(this,(function(s){switch(s.label){case 0:if(e=[],this.loadExternalSheets&&this.rootSvg.ownerDocument)for(n=0;n<this.rootSvg.ownerDocument.childNodes.length;n++)"xml-stylesheet"===(r=this.rootSvg.ownerDocument.childNodes[n]).nodeName&&"string"==typeof r.data&&e.push(t.loadSheet(r.data.match(/href=["'].*?["']/)[0].split("=")[1].slice(1,-1)));for(i=this.rootSvg.querySelectorAll("style,link"),n=0;n<i.length;n++)O(a=i[n],"style")?e.push(a.textContent):this.loadExternalSheets&&O(a,"link")&&"stylesheet"===a.getAttribute("rel")&&a.hasAttribute("href")&&e.push(t.loadSheet(a.getAttribute("href")));return[4,Promise.all(e)];case 1:return[2,s.sent().filter((function(t){return null!==t}))]}}))}))},t.prototype.parseCssSheets=function(e){for(var r=document.implementation.createHTMLDocument(""),i=0,n=e;i<n.length;i++){var a=n[i],s=r.createElement("style");s.textContent=a,r.body.appendChild(s);var o=s.sheet;if(o instanceof CSSStyleSheet){for(var l=o.cssRules.length-1;l>=0;l--){var u=o.cssRules[l];u instanceof CSSStyleRule||o.deleteRule(l);var h=u;if(h.selectorText.indexOf(",")>=0){o.deleteRule(l);for(var f=h.cssText.substring(h.selectorText.length),c=t.splitSelectorAtCommas(h.selectorText),p=0;p<c.length;p++)o.insertRule(c[p]+f,l+p)}}this.styleSheets.push(o)}}},t.splitSelectorAtCommas=function(t){for(var e,r=/,|["']/g,i=/[^\\]["]/g,n=/[^\\][']/g,a=[],s="initial",o=-1,l=i,u=0;u<t.length;)switch(s){case"initial":r.lastIndex=u,(e=r.exec(t))?(","===e[0]?(a.push(t.substring(o+1,r.lastIndex-1).trim()),o=r.lastIndex-1):(s="withinQuotes",l='"'===e[0]?i:n),u=r.lastIndex):(a.push(t.substring(o+1).trim()),u=t.length);break;case"withinQuotes":l.lastIndex=u,(e=l.exec(t))&&(u=l.lastIndex,s="initial")}return a},t.loadSheet=function(t){return new Promise((function(e,r){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="text",i.onload=function(){200!==i.status&&r(new Error("Error "+i.status+": Failed to load '"+t+"'")),e(i.responseText)},i.onerror=r,i.onabort=r,i.send(null)})).catch((function(){return null}))},t.prototype.getPropertyValue=function(t,e){for(var r=[],i=0,n=this.styleSheets;i<n.length;i++)for(var a=n[i],s=0;s<a.cssRules.length;s++){var l=a.cssRules[s];l.style.getPropertyValue(e)&&t.matches(l.selectorText)&&r.push(l)}if(0!==r.length){return r.reduce((function(t,r){return 1===(n=r,(a=(i=t).style.getPropertyPriority(e))!==n.style.getPropertyPriority(e)?"important"===a?1:-1:o(i.selectorText,n.selectorText))?t:r;var i,n,a})).style.getPropertyValue(e)||void 0}},t}();function Rt(t,e,r){var i,n,a;return void 0===r&&(r={}),f(this,void 0,void 0,(function(){var s,o,l,u,f,p,d,m,g,y;return c(this,(function(c){switch(c.label){case 0:return s=null!==(i=r.x)&&void 0!==i?i:0,o=null!==(n=r.y)&&void 0!==n?n:0,l=null!==(a=r.loadExternalStyleSheets)&&void 0!==a&&a,f=new x(u={}),[4,(p=new Vt(t,l)).load()];case 1:return c.sent(),d=new ft(e.internal.pageSize.getWidth(),e.internal.pageSize.getHeight()),m=h(h({},r),{element:t}),g=new v(e,{refsHandler:f,styleSheets:p,viewport:d,svg2pdfParameters:m}),e.advancedAPI(),e.saveGraphicsState(),e.setCurrentTransformationMatrix(e.Matrix(1,0,0,1,s,o)),e.setLineWidth(g.attributeState.strokeWidth),y=g.attributeState.fill.color,e.setFillColor(y.r,y.g,y.b),e.setFont(g.attributeState.fontFamily),e.setFontSize(g.attributeState.fontSize*e.internal.scaleFactor),[4,Ht(t,u).render(g)];case 2:return c.sent(),e.restoreGraphicsState(),e.compatAPI(),g.textMeasure.cleanupTextMeasuring(),[2,e]}}))}))}a.API.svg=function(t,e){return void 0===e&&(e={}),Rt(t,this,e)};export{Rt as svg2pdf};
//# sourceMappingURL=svg2pdf.es.min.js.map
